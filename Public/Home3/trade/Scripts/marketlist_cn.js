$.cookie('nav_index', 0,{ path: '/' });function initMarketlist(){Array.prototype.map||(Array.prototype.map=function(t,a){var e,s,o;if(null==this)throw new TypeError(" this is null or not defined");var n=Object(this),i=n.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(a&&(e=a),s=new Array(i),o=0;o<i;){var r,c;o in n&&(r=n[o],c=t.call(e,r,o,n),s[o]=c),o++}return s});var t=$.cookie("market_title");void 0===$.cookie("custom")&&"custom"===t?(ajaxLoadMarketlist("CNY"),$("#cnyBtn").addClass("btn_selected")):"CNY"===t?(ajaxLoadMarketlist("CNY"),$("#cnyBtn").addClass("btn_selected")):"BTC"===t?(ajaxLoadMarketlist("BTC"),$("#btcBtn").addClass("btn_selected")):"ETH"===t?(ajaxLoadMarketlist("ETH"),$("#ethBtn").addClass("btn_selected")):"custom"===t?($("#customBtn").addClass("btn_selected"),$(".custom-trade-area").show(),ajaxLoadCustom("",3,!1)):(ajaxLoadMarketlist("CNY"),$("#cnyBtn").addClass("btn_selected"))}function editCustom(){$(".hide-show-con").toggle(function(){$(".user-select").show(),$(".hide-show-mark").prop("checked",!0)},function(){$(".user-select").hide(),$(".hide-show-mark").prop("checked",!1)})}function customMark(){var t=$.cookie("custom");void 0!==t&&t.split(",").map(function(t,a){var e=$(".normal-trade-area").find("#"+t);e.find(".coin-name").addClass("has-select"),e.find(".user-select").addClass("has-custom")})}function addCoinCookie(t){var a=t.attr("data-id");if(void 0!==$.cookie("custom")){var e=$.cookie("custom").split(",");if(Array.prototype.in_array=function(t){for(i=0;i<this.length&&this[i]!=t;i++);return!(i==this.length)},!e.in_array(a)){var s=[e,a];$.cookie("custom",s,{expires:365,path:"/"})}}else $.cookie("custom",a,{expires:365,path:"/"})}function cutCoinCookie(t){var a=t.attr("data-id"),e=$.cookie("custom").split(",");!function(t,a){for(var e=0;e<t.length;e++)if(t[e]==a){t.splice(e,1);break}}(e,a),0===e.length?$.removeCookie("custom",{path:"/"}):$.cookie("custom",e,{expires:365,path:"/"})}function hideLoading(){$("#marketlist_controller").find("button .load8").hide()}function ajaxLoadMarketlist(t){var a=LocalStorage.get("cn_datasingle_"+t,!0);if(0==a.status)return $("#marketlist_box").addClass("uncustom").html(a.data),_onLoadMarketListSuccess(),!0;$("#marketlist_box").load("/datasingle/"+t,function(a,e){"success"==e?(LocalStorage.set("cn_datasingle_"+t,a),_onLoadMarketListSuccess()):$(this).html("<div><b class='fail-tip'>数据加载失败，请重试！</b></div>"),hideLoading()}).addClass("uncustom")}function _onLoadMarketListSuccess(){$("#custom_tbody").html(""),inCustom_btn(),customMark(),oTable=$("#marketlist_box").find(".marketlist").DataTable(tableOption),runChart(),$("#cnyBtn").hasClass("from-add")&&$("#normal_tbody").find(".user-select").show(),hideLoading()}function ajaxLoadCustom(t,a,e){function s(){function e(){var a=$("#customlist").find("#"+t+"_plot").parents("tr");a.addClass("new-in").find(".coin-name").addClass("new"),a.find(".user-select").hide(),setTimeout(function(){a.find(".user-select").css("display","")},2e3)}var s=$.cookie("custom");if(void 0!==s&&""!=s){runChart(),1!=a?setTimeout(function(){$(".custom-trade-area").find(".custom-ctrl").show(),$(".hide-show-mark").prop("checked",!1),editCustom()},2e3):$(".user-select").show();var o=$("#customBtn");o.hasClass("active-mark")||setTimeout(function(){customTable=$("#customlist").DataTable(tableOption)},300),o.addClass("active-mark"),o.hasClass("dt-mark")||t&&"undefined"!=typeof initialCo&&""!=s&&setTimeout(function(){customTable.on("draw.dt",function(){$(".user-select").addClass("custom-active").unbind("click"),$(".custom-trade-area").find(".user-select").text("取消自选").click(function(){outCustom($(this))})})},300),o.addClass("dt-mark"),$(".fail-tip").html("")}else"undefined"!=typeof customTable&&customTable.clear().draw(),$("#custom_tbody").html(""),$(".custom-trade-area").find(".custom-ctrl").hide(),0!=a&&void 0===$(".lead-to-add").attr("class")&&($(".fail-tip").html("暂无自选币种！").after("<div class='lead-to-add'><button class='r-btn add-btn'>立即添加</button><p>添加币种到自选区，查看您的关注币种更方便！</p></div>"),$(".add-btn").click(function(){$("#cnyBtn").addClass("from-add").click(),$("#normal_tbody").find(".user-select").show()}));setTimeout(function(){void 0!==t&&""!=t&&$("html, body").animate({scrollTop:$("#"+t).offset().top-150},10,function(){e()})},200),$(".user-select").addClass("custom-active").unbind("click"),$(".custom-trade-area").find(".user-select").text("取消自选").click(function(){outCustom($(this))})}function o(){$(".fail-tip").html("数据未全部加载，请<span id=refresh>刷新</span>重试！"),$("#refresh").click(function(){location.reload()})}function n(t,a){$.ajax({type:a,url:"/marketdata/"+t,dataType:"html",success:function(a){LocalStorage.set("cn_custom_area_"+t,a),$("#custom_tbody").append(a),s()},error:function(){setTimeout(o,200)},complete:function(){hideLoading()}})}$(".normal-trade-area").css("display","none"),$("#custom_box").html('<table class="marketlist dataTable" id=customlist><thead><tr><th class="sorting bizhong">币种</th><th class="sorting market-price">价格</th><th class="orting"><b>交易量</b></th><th class="sorting"><b>总市值</b></th><th class="sorting day-updn"><b>日涨跌</b></th><th class="sorting_disabled price-flot"><b>价格趋势(3日)</b></th><th class="sorting_disabled go-trade"></th></tr></thead><tbody id="custom_tbody"></tbody></table>'),["CNY","BTC","ETH"].forEach(function(t,a){var o=LocalStorage.get("cn_custom_area_"+t,!0);e||0!=o.status?n(t):($("#custom_tbody").append(o.data),s(),hideLoading())})}function inCustom_btn(){$(".user-select").unbind("click").bind("click",function(){var t=$(this),a=t.attr("data-id");return initialCo=$.cookie("custom"),addCoinCookie(t),ajaxLoadCustom(a,0,0!=matchStr.addToStorage("cn_datasingle_",a,"cn_custom_area_").status),$(".custom_btn").addClass("btn_selected").siblings().removeClass("btn_selected"),$(".normal-trade-area").hide(),$(".custom-trade-area").show().find(".custom-ctrl").hide(),$("#marketlist_box").addClass("custom-active"),$.cookie("market_title","custom",{expires:365,path:"/"}),$(this).unbind("click"),!0})}function outCustom(t){cutCoinCookie(t),t.parents("tbody").html(""),ajaxLoadCustom("",1,0!=matchStr.removeFromStorage(t.attr("data-id"),"cn_custom_area_").status)}function rowLink(){$(".marketlist > tbody").find("td").click(function(){var t=$(this).parents("tr").attr("id");window.location="/trade/"+t})}var oTable;tableOption={bFilter:!0,bInfo:!0,"bLengthChange ":!1,bPaginate:!0,bStateSave:!1,dom:"tf",pageLength:-1,language:{sProcessing:"处理中...",sLengthMenu:"每页显示 _MENU_ 币种",sZeroRecords:"没有匹配币种",sInfo:"当前显示第 _START_ 至 _END_ 币种，共 _TOTAL_ 币种",sInfoFiltered:"( 从 _MAX_ 币种中搜索 )",sEmptyTable:"暂无数据",sLoadingRecords:"载入中...",sSearch:"",sSearchPlaceholder:"搜索",sInfoThousands:",",oPaginate:{sFirst:"首页",sPrevious:"上一页",sNext:"下一页",sLast:"末页"}},aaSorting:[],aoColumnDefs:[{sType:"string",aTargets:[0]},{sType:"price",sClass:"alignRight",aTargets:[1]},{sType:"volume",sClass:"alignRight",aTargets:[2]},{sType:"volume",sClass:"alignRight",aTargets:[3]},{sType:"percent",sClass:"alignRight",aTargets:[4]},{asSorting:["desc","asc"],aTargets:[1,2,3,4]}]},jQuery.extend(jQuery.fn.dataTableExt.oSort,{"totalsupply-pre":function(t){return"<"==t[0]&&(t=$(t).text()),(t=parseFloat(t.substring(0,t.length-4).split(",").join("")))||(t=0),t},"totalsupply-asc":function(t,a){return t-a},"totalsupply-desc":function(t,a){return a-t}}),jQuery.extend(jQuery.fn.dataTableExt.oSort,{"currency-pre":function(t){return(t=parseFloat("-"===t?0:t.replace(/[^\d\-\.]/g,"")))||(t=0),t},"currency-asc":function(t,a){return t-a},"currency-desc":function(t,a){return a-t}}),jQuery.extend(jQuery.fn.dataTableExt.oSort,{"price-pre":function(t){return"?"==t?0:(a0=t,(t=parseFloat("-"===t?0:t.replace(/[^\d\-\.]/g,"")))||(t=0),t)},"price-asc":function(t,a){return t-a},"price-desc":function(t,a){return a-t}}),jQuery.extend(jQuery.fn.dataTableExt.oSort,{"volume-pre":function(t){return"?"==t?0:(t=parseFloat("-"===t?0:t.replace(/[^\d\-\.]/g,"")),(t=parseFloat(t))||(t=0),t)},"volume-asc":function(t,a){return t-a},"volume-desc":function(t,a){return a-t}}),jQuery.extend(jQuery.fn.dataTableExt.oSort,{"percent-pre":function(t){return(t=parseFloat(t.replace(/[^\d\-\.]/g,"")))||(t=-99999),t},"percent-asc":function(t,a){return t-a},"percent-desc":function(t,a){return a-t}}),initMarketlist(),editCustom(),customMark(),$("#marketlist_controller").find("button").click(function(){$(this).addClass("btn_selected").siblings().removeClass("btn_selected"),$(this).siblings().find(".load8").hide(),$(this).find(".load8").show(),$(".hide-show-mark").prop("checked",!1),$(".hide-show-con").unbind("clcik"),editCustom();var t=$(this).attr("value");if($.cookie("market_title",t,{expires:365,path:"/"}),"custom"===t){var a=$.cookie("custom");$(".normal-trade-area").css("display","none"),$(".custom-trade-area").css("display","block"),void 0!==a&&""!=a?ajaxLoadCustom("",2,!1):($(".custom-trade-area").find(".custom-ctrl").hide(),void 0===$(".lead-to-add").attr("class")&&($(".fail-tip").html("暂无自选币种！").after("<div class='lead-to-add'><button class='r-btn add-btn'>立即添加</button><p>添加币种到自选区，查看您的关注币种更方便！</p></div>"),$(".add-btn").click(function(){$("#cnyBtn").addClass("from-add").click(),$("#normal_tbody").find(".user-select").show()})),hideLoading())}else"CNY"!=t&&$("#cnyBtn").removeClass("from-add"),$(".normal-trade-area").css("display","block"),$(".custom-trade-area").css("display","none"),$("#customBtn").removeClass("dt-mark active-mark"),ajaxLoadMarketlist(t),$(".fail-tip").html(""),$(".lead-to-add").remove();return!1});